# Проектная работа "Веб-ларек"

Web-ларёк - интернет-магазин для веб-разработчиков. Широкий выбор программных решений, скиллов и других инструментов для веб-разработки.

## Используемый стек

- **Frontend:** HTML, SCSS, TypeScript, Webpack

## Структура проекта

- `src/` — исходные файлы проекта
- `src/components/` — папка с компонентами на JavaScript
- `src/components/base/` — папка с базовым кодом

### Важные файлы:

- `src/pages/index.html` — HTML-файл главной страницы
- `src/types/index.ts` — файл с типами
- `src/index.ts` — точка входа приложения
- `src/scss/styles.scss` — корневой файл стилей
- `src/utils/constants.ts` — файл с константами
- `src/utils/utils.ts` — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Архитектура проекта

## Основные типы данных

### CategoryType
Перечисление доступных категорий продуктов:
- `SoftSkill`: "софт-скил"
- `HardSkill`: "хард-скил"
- `Other`: "другое"
- `Button`: "кнопка"
- `Additional`: "дополнительное"

### IProduct
Интерфейс, описывающий продукт:
- `id`: Уникальный идентификатор продукта.
- `description`: Описание продукта.
- `image`: Ссылка на изображение.
- `title`: Название продукта.
- `category`: Категория из `CategoryType`.
- `price`: Цена, может быть `null`.
- `selected`: Опционально, указывает, добавлен ли товар в корзину.

### IAppState
Интерфейс состояния приложения:
- `basket`: Массив продуктов в корзине.
- `store`: Массив всех продуктов.
- `order`: Информация о текущем заказе.
- `formErrors`: Ошибки форм.

### IOrder
Интерфейс для заказа:
- `items`: Массив ID купленных товаров.
- `payment`: Способ оплаты.
- `total`: Сумма заказа.
- `address`: Адрес доставки.
- `email`: Электронная почта.
- `phone`: Телефон.

## Базовый код

### Class Api
Базовый класс для всех взаимодействий с API. Обеспечивает методы для выполнения HTTP-запросов.
- `constructor(baseUrl: string, options: RequestInit = {})`: Инициализирует экземпляр с базовым URL и настройками запроса.
- `get(uri: string)`: Выполняет GET-запрос.
- `post(uri: string, data: object, method: ApiPostMethods = 'POST')`: Выполняет POST-запрос, может также использоваться для PUT и DELETE.
- `handleResponse(response: Response)`: Обрабатывает ответ сервера, преобразуя его в JSON или генерируя ошибку.

### Class EventEmitter
Класс для управления событиями, реализует интерфейс `IEvents`.
- `on<T extends object>(eventName: EventName, callback: (data: T) => void)`: Подписывается на событие.
- `emit<T extends object>(eventName: string, data?: T)`: Генерирует событие, передавая данные подписчикам.
- `trigger<T extends object>(eventName: string, context?: Partial<T>)`: Создает функцию, которая при вызове инициирует событие с указанными данными.

### Abstract class Component<T>
Абстрактный базовый класс для всех UI компонентов. Предоставляет базовые методы для взаимодействия с DOM.
- Методы: `toggleClass`, `setText`, `setDisabled`, `setHidden`, `setVisible`, `setImage`, `render`.

### Abstract class Model<T>
Абстрактный базовый класс для всех моделей данных. Предоставляет методы для управления данными.
- Методы: `updateData`.

## Классы модели данных (MODEL)

### Class Product
Класс `Product` представляет собой модель продукта и наследуется от базового класса `Model`. Он используется для работы с данными продукта.

#### Свойства:
- `id: string`: Уникальный идентификатор продукта.
- `description: string`: Описание продукта.
- `image: string`: Ссылка на изображение продукта.
- `title: string`: Название продукта.
- `category: CategoryType`: Категория продукта. Тип `CategoryType` должен быть определен в другом месте вашего проекта.
- `price: number | null`: Цена продукта. Может быть `null`, если цена не указана.
- `selected: boolean`: Флаг, указывающий, выбран ли продукт пользователем.

Этот класс позволяет удобно управлять данными продукта и использовать их в различных частях приложения.

## Class AppState

Класс `AppState` представляет собой центральное хранилище состояния приложения и наследуется от базового класса `Model`. Он содержит данные корзины, магазина, заказа и ошибки форм.

#### Свойства:
- `basket: Product[]`: Массив продуктов в корзине.
- `store: Product[]`: Массив доступных продуктов в магазине.
- `order: IOrder`: Данные текущего заказа.
- `formErrors: FormErrors`: Ошибки валидации форм.

#### Методы:
- `addToBasket(product: Product)`: Добавляет продукт в корзину, если он ещё не добавлен.
- `removeFromBasket(id: string)`: Удаляет продукт из корзины по идентификатору.
- `clearBasket()`: Очищает корзину.
- `validateContacts()`: Валидирует контактные данные заказа.
- `validateOrder()`: Валидирует данные заказа.
- `setOrderField(field: keyof IOrderForm, value: string)`: Устанавливает значение поля заказа.
- `validateForm()`: Валидирует все формы.
- `updateOrder()`: Обновляет данные заказа.
- `getCartAmount()`: Возвращает количество товаров в корзине.
- `setItems()`: Назначает товары из корзины в заказ.
- `getFullBasketPrice()`: Возвращает полную стоимость товаров в корзине.
- `resetSelected()`: Сбрасывает выбор товаров в магазине.
- `setStore(items: IProduct[])`: Устанавливает товары магазина и обновляет данные.

Этот класс управляет основными взаимодействиями и данными в приложении, обеспечивая централизованное управление состоянием.

### Class Basket

Основной класс для управления корзиной покупок.

#### Свойства:
- `items`: Map<string, Product> - хранит продукты в корзине, где ключ - это ID продукта.

#### Методы:
- `addItem(product: Product)`: Добавляет продукт в корзину или увеличивает его количество.
- `removeItem(productId: string)`: Уменьшает количество продукта на единицу или удаляет его из корзины, если продукт был в единичном экземпляре.
- `getTotal()`: Возвращает общую стоимость товаров в корзине.
- `clearCart()`: Очищает корзину.

### VIEW

### Class Card

Класс `Card` представляет собой компонент для отображения карточки продукта и наследуется от базового класса `Component`. Он инкапсулирует элементы UI карточки и предоставляет интерфейс для их управления.

#### Свойства:
- `_title: HTMLElement`: Элемент заголовка продукта.
- `_image: HTMLImageElement`: Элемент изображения продукта.
- `_category: HTMLElement`: Элемент категории продукта.
- `_price: HTMLElement`: Элемент цены продукта.
- `_button: HTMLButtonElement`: Кнопка действия на карточке.

#### Методы:
- `set id(value: string)`: Устанавливает идентификатор продукта в атрибут контейнера.
- `get id()`: Возвращает идентификатор продукта из атрибута контейнера.
- `set title(value: string)`: Устанавливает заголовок продукта.
- `get title()`: Возвращает заголовок продукта.
- `set image(value: string)`: Устанавливает путь к изображению продукта, добавляя URL CDN.
- `set selected(value: boolean)`: Устанавливает состояние выбора продукта, отключая кнопку, если продукт выбран.
- `set price(value: number | null)`: Устанавливает текст цены продукта. Если цена отсутствует, указывает "Бесценно" и отключает кнопку.
- `set category(value: CategoryType)`: Устанавливает категорию продукта и добавляет соответствующий класс для стилизации.

#### Наследование:
- `ShopItem extends Card`: Класс для элемента магазина. Использует префикс класса 'card'.
- `ShopItemPreview extends Card`: Класс для предпросмотра элемента магазина. Добавляет описание продукта.

Эти классы позволяют легко создать и управлять карточками продуктов в пользовательском интерфейсе, обеспечивая гибкость и масштабируемость в проектировании компонентов.

### Class Order

Класс страницы заказа, использует `Cart` для управления заказом.

#### Свойства:
- `cart`: Cart - экземпляр корзины, с которым работает страница заказа.

#### Методы:
- `displayOrderSummary()`: Отображает сводку заказа.
- `checkout()`: Оформляет заказ, очищает корзину после завершения.

## Class PageContainer

### Описание
`PageContainer` управляет основными элементами пользовательского интерфейса на странице.

### Свойства
- `_counter`: HTMLElement - элемент для отображения количества товаров в корзине.
- `_store`: HTMLElement - контейнер для отображения товаров.
- `_wrapper`: HTMLElement - основной контейнер страницы.
- `_basket`: HTMLElement - элемент для доступа к корзине.

### Конструктор
Принимает `container` (HTMLElement) и `events` (IEvents). Инициализирует элементы страницы и слушатели событий.

### Методы
- `initializeEventListeners()`: Устанавливает обработчики событий, например, открытие корзины при клике.

### Сеттеры
- `counter(value: number)`: Задаёт количество товаров в корзине.
- `store(items: HTMLElement[])`: Заполняет контейнер товаров элементами.
- `locked(value: boolean)`: Переключает блокировку интерфейса.

## Class Purchased

### Описание
`Purchased` управляет отображением информации о совершенной покупке.


### Свойства
- `_button`: HTMLButtonElement | null - кнопка закрытия.
- `_description`: HTMLElement | null - элемент для отображения описания.

### Методы
- `initializeEventListeners(onClick: (event: MouseEvent) => void)`: Устанавливает обработчик события клика для кнопки закрытия.

### Сеттеры
- `description(value: string)`: Задаёт текст описания, отображаемого после покупки.

## Class ContactForm

## Описание
`ContactForm` управляет формой сбора контактной информации пользователей, такой как телефон и email. Этот класс расширяет функциональность базового класса `Form<IContactInfo>`.

## Конструктор
Принимает два параметра:
- `container`: `HTMLFormElement` - элемент формы в DOM.
- `eventHandlers`: `IEvents` - объект с обработчиками событий для формы.

## Методы
`initializeForm()` - Инициализирует форму, устанавливая необходимые обработчики событий.

`validateContactInfo(contactInfo: IContactInfo): boolean` - Проверяет правильность контактной информации. Возвращает `true`, если информация валидна.

## События в приложении

### Основные события

- **`items:changed`**: Инициируется при изменении списка товаров и вызывает перерисовку списка товаров на странице.
- **`card:select`**: Инициируется при клике на карточку товара, приводя к открытию модального окна с подробным описанием товара.
- **`card:toBasket`**: Инициируется при клике на кнопку "В корзину" на карточке товара, добавляет товар в корзину и обновляет счётчик на корзине.
- **`basket:open`**: Инициируется при клике на кнопку "корзина", открывая модальное окно, где отображаются товары, добавленные в корзину.
- **`basket:delete`**: Инициируется при клике на кнопку удаления товара в корзине, удаляет товар из корзины и обновляет сумму заказа.
- **`basket:order`**: Инициируется при клике на кнопку "Оформить" в корзине, открывая окно с формой для заполнения адреса и способа оплаты.
- **`order:submit`**: Инициируется при нажатии на кнопку "Далее" на стадии заполнения адреса и способа оплаты.
- **`contacts:submit`**: Инициируется при нажатии на кнопку "Оплатить" на стадии заполнения телефона и электронной почты.
- **`orderInput:change`**: Инициируется при вводе данных в форму заказа и начинает процесс валидации формы.
- **`orderFormErrors:change`**: Инициируется при вводе данных в форму заказа и обновляет ошибки формы.
- **`contactsFormErrors:change`**: Инициируется при вводе данных в форму контактов и обновляет ошибки формы.
- **`order:success`**: Инициируется при успешном ответе сервера при оплате товара, открывая модальное окно о успешной оплате.
- **`modal:close`**: Инициируется при клике на кнопку закрытия модального окна или при клике на свободное место вокруг модального окна.